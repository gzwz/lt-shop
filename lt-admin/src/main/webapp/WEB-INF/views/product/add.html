<#assign contextPath=springMacroRequestContext.getContextPath() />
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>资源管理</title>

<#include "/public/frame/metrnic.html">
<link href="${contextPath}/resources/css/bootstrap.minb16a.css?v=3.3.5"
	rel="stylesheet">
<link
	href="${contextPath}/resources/css/font-awesome.min93e3.css?v=4.4.0"
	rel="stylesheet">
<!-- jqgrid-->
<link
	href="${contextPath}/resources/css/plugins/jqgrid/ui.jqgridffe4.css?0820"
	rel="stylesheet">
<link href="${contextPath}/resources/css/animate.min.css"
	rel="stylesheet">
<link href="${contextPath}/resources/css/style.min1fc6.css?v=4.0.0"
	rel="stylesheet">

<link
	href="${contextPath}/resources/css/plugins/sweetalert/sweetalert.css"
	rel="stylesheet">
<style>
/* Additional style to fix warning dialog position */
#alertmod_table_list_2 {
	top: 900px !important;
}

li{list-style: none;margin-right:10px;}
li label{cursor: pointer;}
.Father_Title{float: left;}
</style>
<link rel="stylesheet" href="${contextPath}/resources/ueditor/themes/default/css/ueditor.min.css" />
<script type="text/javascript">
  	var contextPath = '${contextPath}';
    var plugins_webuploader = '${contextPath}/resources/js/plugins/webuploader';
    var image_servler_url = '${contextPath}/upload_image';
</script>
</head>
<script type="text/javascript" src="${contextPath}/resources/productSKU/js/jquery1.7.2/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="${contextPath}/resources/productSKU/js/liandong.js"></script>
<link rel="stylesheet" href="${contextPath}/resources/ztree/css/zTreeStyle/zTreeStyle.css" type="text/css">
<body class="gray-bg">
	<div class="wrapper wrapper-content animated fadeInRight">
		<div class="row">
			<div class="col-sm-12">
				<div class="ibox ">
					<div class="ibox-content">
				         <div class="row">
							<div class="col-md-12">
								<div class="tabbable tabbable-custom">
									<ul class="nav nav-tabs">
									
										<li id="category" class="active"><a href="javascript:void(0);">类型添加</a></li>
										<li id="propoty" class="active" style="display: none;"><a href="javascript:void(0);">属性添加</a></li>
										<li id="product" class="active" style="display: none;"><a href="javascript:void(0);">商品添加</a></li>
									</ul>
									<div class="tab-content">
										<div class="tab-pane active fontawesome-demo">
											<div class="portlet-body form">
												<!-- BEGIN FORM-->
												<form action="${contextPath}/product/create"
													class="form-horizontal" method="post" id="form2">
													 <fieldset id="category-content">
															<div class="form-group">
																		<label class="col-sm-2 control-label">产品类型:</label>
																		<div class="col-sm-6">
																			<div class="input-group">
																				<div class="input-icon">
																					<input id="newpassword"  class="text-input form-control" type="text" placeholder="请选择产品类型" readonly value="">
																					<input type="hidden" id="productCategoryId" name="productCategoryId" class="hidden-input" value=""/>
																				</div>
																				<span class="input-group-btn">
																					<a class="btn btn-success" type="button" data-url='${contextPath}/productCategory/getPermData.html' data-current-id='' data-toggle='iceModal' data-target='#MyModalPerm'><i class="fa fa-search fa-fw"></i>选择</a>
																				</span>
																			</div>
																		</div>
																	</div>
																	
						                              </fieldset>
													
													<fieldset id="product-brand"  style="display: none;">
													   
													     <div class="form-group">
				                                            <label class="control-label col-md-2">品牌:</label>
				                                          <div class="col-md-4">
															<select id="productBrandId" class="form-control select2me" name="productBrandId">
																
															</select>
														   </div>
														
														 </div>
														 
														 <div class="form-group">
																<label class="col-md-2 control-label">属性:</label>
																<div class="col-md-4">
															         <div class="div_contentlist table table-striped table-bordered table-condensed">
															          </div> 
												                    <div class="div_contentlist2">
												                           <div id="createTable"></div>
												                    </div>
															  	</div>
															</div>
															
															
															<div class="form-group">
																<label class="col-sm-2 control-label">筛选条件:</label>
																<div class="col-sm-6">
																	<ul id="treeDemo" class="ztree"></ul>
																</div>
															</div> 
													</fieldset>
													
				                                      <fieldset id="product-content" style="display: none;">
				                                      
				                                          <div class="form-group">
					                                            <label class="control-label col-md-2">商品名称:</label>
					                                            <div class="col-md-4">
					                                               <input type="text" name="name" data-required="1" placeholder="商品名称" class="form-control"/>
					                                             </div>
					                                        </div>
				                                      
				                                         <div class="form-group">
				                                             <label class="control-label col-md-2">商家</label>
				                                             <div class="col-sm-4">
					                                            <select class="form-control" name="merchantId">
																   <#if merchantList?exists> 
												           	         <#list merchantList as merchant>
																	      <option value="${merchant.id!''}">${merchant.baseInfo.name}</option>
																	 </#list>
													              </#if>
													              </select>
																	</div>
														 </div> 
														 
				                                        
														   <div class="form-group">
					                                            <label class="control-label col-md-2">市场价</label>
					                                            <div class="col-md-4">
					                                               <input type="text" name="originalPrice" data-required="1" placeholder="市场价" class="form-control"/>
					                                             </div>
					                                        </div>
					                                        
				                                        <div class="form-group">
														    <label class="control-label col-md-2">最低价</label>
															<div class="col-md-4">
																<input type="text" name="lowestPrice" data-required="1"
																	placeholder="最低价" 
																	class="form-control" />
															</div>
													    </div>
				                                        
				                                        <div class="form-group">
				                                            <label class="control-label col-md-2">商品首图</label>
				                                            <div class="col-md-7">
				                                                <span class="btn btn-success fileinput-button">
				                                                 <i class="glyphicon glyphicon-plus"></i>
				                                                    <span>上传文件</span>
				                                                    <input id="fileupload" type="file" name="file">
				                                                    <input id="fileuploadInput" type="hidden" name="titleImage">
				                                                </span>
				                                                <img id="img" class="img-thumbnail" src="" style="width: 100px; height:66px; display: none;"/>
				                                            </div>
				                                        </div>
				                                        
				                                        <div class="form-group">
															<label class="col-md-2 control-label">图片集</label>
															<div class="col-md-7">
																	<span class="btn btn-success fileinput-button"> <i
																		class="glyphicon glyphicon-plus"></i> <span>上传文件</span> <input
																		id="imageupload" type="file" name="file"
																		multiple="multiple">
																	</span>
																<div id="imageuploadCon" class="row clearfix margin-top-10">
																</div>
															</div>
														</div>
																			
													<div class="form-group">
														<label class="control-label col-md-2">商品简介</label>
														<div class="col-md-9">
														
														     <script type="text/plain" id="intro" name="intro"
																				style="height: 240px;"></script>
														</div>
													</div>
				                                       
													
													<div class="form-group">
														<label class="col-sm-2 control-label">详情：</label>
														<div class="col-sm-9">
															<div class="panel blank-panel">
																<div class="panel-heading">
																	<div class="panel-options">
																		<ul class="nav nav-tabs">
																			<li class="active"><a data-toggle="tab"
																				href="tabs_panels.html#tab-pc" aria-expanded="true"><i
																					class="fa fa-desktop" style="width: 100px;">&nbsp;电脑端详情</i></a></li>
																			<li class=""><a data-toggle="tab"
																				href="tabs_panels.html#tab-mobile" aria-expanded="false"><i
																					class="fa fa-laptop" style="width: 100px;">&nbsp;手机端详情</i></a></li>
																		</ul>
																	</div>
																</div>
																<div class="panel-body">
																	<div class="tab-content">
																		<div id="tab-pc" class="tab-pane active">
																			<script type="text/plain" id="pcDetail" name="pcDetail"
																				style="height: 240px;"></script>
																		</div>
																		<div id="tab-mobile" class="tab-pane">
																			<script type="text/plain" id="mobileDetail" name="mobileDetail"
																				style="height: 240px;"></script>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
													<input type="hidden" id="screeningId"  name="screeningId"/>
				                                </fieldset>
													<div class="form-actions">
														<div class="row">
															<div class="col-md-offset-2 col-md-9"> 
															   <button id="prve" style="display: none;" type="button" class="btn btn-default"><i class="m-icon-swapleft m-icon-white"></i>上一步</button> 
															    <button id="prve-product" style="display: none;" type="button" class="btn btn-default"><i class="m-icon-swapleft m-icon-white"></i> 上一步</button>                       
															    <button id="next" type="button" class="btn btn-primary active"><i class="m-icon-swapright m-icon-white"></i> 下一步</button>
															    <button id="next-product" style="display: none;" type="button" class="btn btn-primary active"><i class="m-icon-swapright m-icon-white"></i> 下一步</button>
																<button id="submitForm"  style="display: none;" type="submit" class="btn btn-info ">确认提交</button>
															</div>
														</div>
													</div>
												</form>
												<!-- END FORM-->
											</div>
										</div>
									</div>
								</div>
							</div>
		               </div>
			<!-- END PAGE CONTENT-->
               </div>
			</div>
		</div>
	</div>
</div>
	
	
	
	
	
	
	
	<!-- 对话框 start -->
<div class="modal fade bs-example-modal-sm" id="MyModalPerm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">添加信息</h4>
      </div>
      <div class="modal-body">
       		<div class="jstree"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default calcel" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary save">保存</button>
      </div>
    </div>
  </div>
</div>


<!-- 对话框 end -->
	<script src="${contextPath}/resources/js/jquery.min63b9.js?v=2.1.4"></script>
	<script src="${contextPath}/resources/js/bootstrap.minb16a.js?v=3.3.5"></script>
	<script
		src="${contextPath}/resources/js/plugins/peity/jquery.peity.min.js"></script>
	<script
		src="${contextPath}/resources/js/plugins/jqgrid/i18n/grid.locale-cnffe4.js?0820"></script>
	<script
		src="${contextPath}/resources/js/plugins/jqgrid/jquery.jqGrid.minffe4.js?0820"></script>
	<script src="${contextPath}/resources/js/plugins/layer/layer.js"></script>
	<script src="${contextPath}/resources/js/content.mine209.js?v=1.0.0"></script>
	
<script type="text/javascript" charset="utf-8" src="${contextPath}/resources/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="${contextPath}/resources/ueditor/ueditor.all.min.js"></script>
<#include "/public/frame/metrnicjs.html">


<script type="text/javascript" src="${contextPath}/resources/ztree/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="${contextPath}/resources/ztree/js/jquery.ztree.excheck.js"></script>
<script
		src="${contextPath}/resources/js/plugins/sweetalert/sweetalert.min.js"></script>
	<script src="${contextPath}/resources/js/common.js"></script>
<script>
	jQuery(document).ready(
			function() {
			var intro = UE.getEditor('intro');
			var pcUE = UE.getEditor('pcDetail');
		    var mobileUE = UE.getEditor('mobileDetail');
				Metronic.init(); // 公共js  必须加入
				Layout.init(); //   布局js  必须加入
				QuickSidebar.init(); // 右边sidebar 必须加入
				
				
				
				$('#imageupload')
				.fileupload(
						{
							url : "${contextPath}/file/upload.html",
							dataType : 'json',
							done : function(e, data) {
								if (data.result.success) {
									var tr = "<div class='thumbnail col-md-4 image-container'>"
											+ "<a class='image-preview' href='${contextPath}/imageViewInModal.html?src=${imageContextPath}/"
											+ data.result.url
											+ "' data-toggle='modal' data-target='#accountManager'><img src='${imageContextPath}/" 
							        		+ data.result.url
							        		+ "' style='max-height: 140px;'></a>"
											+ "<input type='hidden' name='images' value='" 
							        		+ data.result.url  
							        		+ "'><span href='javascript:void(0);' class='glyphicon glyphicon-remove-circle delete-image' style='display: none;'></span></div>";
											$("#imageuploadCon")
											.append(tr);
								} else {
									alert(data.result.msg);
								}
							}
						});
				
				
				
				
				$('#fileupload').fileupload({
	                url: "${contextPath}/file/upload/",
	                dataType: 'json',
	                done: function (e, data) {
	                    $("#img").attr("src", "${imageContextPath}/" + data.result.url).css("display", "inline");
	                    $("#fileuploadInput").val(data.result.url);
	                }
	            });
				
				
				
				$("#propoty-content").hide();
				$("#propoty").hide();	
                $("#product").hide();
                
                $("#next").click(function(){
                   if($("#productCategoryId").val()==""){
                    layer.alert('请选择产品类型!', {
					    skin: 'layui-layer-molv' //样式类名
					    ,closeBtn: 0
					}); 
					return;
                   }
                
                
                 
                    $(this).hide();
                    $("#product-brand").show();
                    $("#category-content").hide();
                    $("#prve").show();
                    $("#next-product").show();
                    $("#category").hide();
                    $("#propoty").show();
                    
                    var setting = {
						check: {
							enable: true
						},
						data: {
							simpleData: {
								enable: true
							}
						}
					};
                    
                      $.ajax({
						     url : "${contextPath}/screeningCondition/getScreeningData?productCategoryIds="+$("#productCategoryId").val(), 
						type : "post",
						dataType : "json", 
						success :function(data){
						  $.fn.zTree.init($("#treeDemo"), setting, data);
							var zTree = $.fn.zTree.getZTreeObj("treeDemo");
							zTree.setting.check.chkboxType ={"Y" : "ps", "N" : "ps"};
						}
					});
					
			   //获得品牌的值
                 $.ajax({
						type : "post",
						url : "${contextPath}/productBrand/getProductBrand",
						dataType : "json",
						data:{productCategoryIds:$("#productCategoryId").val()},
						async : true,
						success : function(data) {
							var result = "";
							if (data.length > 0) {
								for (var i = 0; i < data.length; i++) {
									if (i == 0) {
										result += "<option value=''>请选择</option>";
									}
									
									    result += "<option value='" + data[i].id+ "'>"
											+ data[i].brandName
											+ "</option>"; 
									
								}
							}
							$("#productBrandId").html("");
							$("#productBrandId").html(result);
						}
					});
					
					
					//获得属性与属性值
					$.ajax({
						type : "post",
						url : "${contextPath}/productParameter/getProductParameter",
						dataType : "json",
						data:{productCategoryIds:$("#productCategoryId").val()},
						async : true,
						success : function(data) {
							var result = "";
							var portory="";
							if (data.length > 0) {
								for (var i = 0; i < data.length; i++) {
								               
								    result +="<input type='hidden' name='parameterId' value='"+data[i].id+"'><ul class='Father_Title'><li>"+data[i].name+"</li></ul><ul class='Father_Item"+i+"'>";
												    if(data[i].productParameterValueDTO.length>0){
												      for(var j=0;j<data[i].productParameterValueDTO.length;j++){
												       portory+="<li class='li_width'><label><input id='Checkbox3' name='proportyValueId' type='checkbox' class='chcBox_Width' value='"+data[i].productParameterValueDTO[j].name+"' />"+data[i].productParameterValueDTO[j].name+"<span class='li_empty'  contentEditable='true'></span></label></li>" ;
												       }
												    }  
								  result=result +portory+"</ul><br/>";
								  portory="";
								}
							}
							 $(".div_contentlist").html("");
							$(".div_contentlist").html(result); 
						}
					});
                    
                });	
                
             
             
             $("#form2").validate({
						rules : {
							name : {
								required : !0,
								minlength : 2
							},
							productCategoryId : {
								required : true
							}, 
							titleImage : {
								required : true
							},
							intro : {
								required : true
							},
							productBrandId : {
								required : true
							},
							detail : {
								required : true
							},
							merchantId : {
								required : true
							},
							originalPrice : {
								maxlength : 10,
							    required : true,
							    digits : true
							},
							lowestPrice : {
								maxlength : 10,
							    required : true,
							    digits : true
							}
							
						},
						messages : {
							name : {
								required :"请输入正确的商家名称",
								minlength : "资源名称必须两个字符以上"
							},
							originalPrice:{
								required : "请输入",
											maxlength : "长度不能大于10",
											digits : "必须为整数"
								}
						},
						submitHandler : function() {
							  var treeObj=$.fn.zTree.getZTreeObj("treeDemo");
		            nodes=treeObj.getCheckedNodes(true);
		            var resourseIds="";
		            for(var i=0;i<nodes.length;i++){
		            resourseIds+=nodes[i].id + ",";
					}
							$("#screeningId").val(resourseIds);
							$("#form2").ajaxSubmitForm(refurbishCollback);
						}
					});
    
                
                
                   
                
                 $("#next-product").live("click",function(){
                    if($("#productBrandId").val()==""){
                       layer.alert('请选择品牌!', {
					    skin: 'layui-layer-molv' //样式类名
					    ,closeBtn: 0
					}); 
					return;
                    }
                    $(this).hide();
                    $("#product-brand").hide();
                    $("#product").show();
                    $("#category-content").hide();
                    $("#product-content").show();
                    $("#prve-product").show();
                    $("#prve").hide();
                    $("#category").hide();
                    $("#propoty").hide();
                     $("#submitForm").show();
                     $ ('#process tr').each (function (){
                            $(this).find("td:last .groupNumbers").remove();
					        $(this).find("td:last").append("<input type='hidden' class='groupNumbers' name='skuSpecInfos' value='"+$(this).text()+"'/>");
					        });
                 });
                 
                 
                 $("#prve-product").live("click",function(){
                    $(this).hide();
                    $("#prve").show();
                    $("#product-brand").show();
                    $("#product").hide();
                    $("#category-content").hide();
                    $("#product-content").hide();
                    $("#category").hide();
                    $("#propoty").show();
                    $("#submitForm").hide();
                    $("#next-product").show();
                 });
                 
                 
                 $("#prve").live("click",function(){
                    $(this).hide();
                    $("#prve-product").hide();
                    $("#product-brand").hide();
                    $("#product").hide();
                    $("#category-content").show();
                    $("#product-content").hide();
                    $("#category").show();
                    $("#propoty").hide();
                    $("#submitForm").hide();
                    $("#next-product").hide();
                    $("#next").show();
                 });
                
			});
			
			//js去掉重复的数据
			function unique(arr) {
			    var result = [], hash = {};
			    for (var i = 0, elem; (elem = arr[i]) != null; i++) {
			        if (!hash[elem]) {
			            result.push(elem);
			            hash[elem] = true;
			        }
			    }
			    return result;
			//http://www.cnblogs.com/sosoft/
			}
			
</script> 

</body>
</html>